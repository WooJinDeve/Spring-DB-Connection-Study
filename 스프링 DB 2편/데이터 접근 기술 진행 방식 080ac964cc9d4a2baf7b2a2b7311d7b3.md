# 데이터 접근 기술 진행 방식

## 데이터 접근 기술 방식

- **SQLMapper**
    - `JdbcTemplate`
    - `MyBatis`
- **ORM 관련 기술**
    - `JPA`, `Hibernate`
    - `스프링 데이터 JPA`
    - `Querydsl`
    
- **SQL Mapper 주요기능**
    - 개발자는 `SQL`만 작성하면 해당 `SQL`의 결과를 객체로 편리하게 매핑해준다.
    - `JDBC`를 직접 사용할 때 발생하는 여러가지 중복을 제거해주고, 기타 개발자에게 여러가지 편리한 기능을 제공한다.
- **ORM 주요 기능**
    - `JdbcTemplate`이나 `MyBatis` 같은 `SQL 매퍼 기술`은 `SQL`을 개발자가 직접 작성해야 하지만, JPA를 사용하면 기본적인 `SQL`은 `JPA`가 대신 작성하고 처리해준다. 개발자는 저장하고 싶은 객체를 마치 자바 컬렉션에 저장하고 조회하듯이 사용하면 `ORM` 기술이 데이터베이스에 해당 객체를 저장하고 조회해준다.
    - `JPA`는 자바 진영의 `ORM` 표준이고, `Hibernate(하이버네이트)`는 `JPA`에서 가장 많이 사용하는 구현체이다. 자바에서 `ORM`을 사용할 때는 `JPA 인터페이스`를 사용하고, 그 구현체로 하이버네이트를 사용한다고 생각하면 된다
    
- **DTO(data transfer object)**
    - 데이터 전송 객체
    - `DTO`는 기능은 없고 데이터를 전달만 하는 용도로 사용되는 객체를 뜻한다.
    참고로 `DTO`에 기능이 있으면 안되는가? 그것은 아니다. 객체의 주 목적이 데이터를 전송하는 것이라면 `DTO`라 할 수 있다.
    
- **@EventListener(ApplicationReadyEvent.class)**
    - 스프링 컨테이너가 완전히 초기화를 다 끝내고, 실행 준비가 되었을 때 발생하는 이벤트이다. 스프링이 이 시점에 해당 애노테이션이 붙은 `initData()` 메서드를 호출해준다.
        - 참고로 이 기능 대신 `@PostConstruct` 를 사용할 경우 `AOP` 같은 부분이 아직 다 처리되지 않은 시점에 호출될 수 있기 때문에, 간혹 문제가 발생할 수 있다. `@Transactional` 과 관련된 `AOP`가 적용되지 않은 상태로 호출될 수 있다.
        - `@EventListener(ApplicationReadyEvent.class)` 는 `AOP`를 포함한 스프링 컨테이너가 완전히 초기화 된 이후에 호출되기 때문에 이런 문제가 발생하지 않는다.
        
- 프로필
    - 스프링은 로딩 시점에 `application.properties` 의 `spring.profiles.active` 속성을 읽어서
    프로필로 사용한다.
    - 이 프로필은 로컬(나의 PC), 운영 환경, 테스트 실행 등등 다양한 환경에 따라서 다른 설정을 할 때 사용하는 정보이다.
    - 예를 들어서 로컬PC에서는 로컬 PC에 설치된 데이터베이스에 접근해야 하고, 운영 환경에서는 운영 데이터베이스에 접근해야 한다면 서로 설정 정보가 달라야 한다. 심지어 환경에 따라서 다른 스프링 빈을 등록해야 할 수 도 있다. 프로필을 사용하면 이런 문제를 깔끔하게 해결할 수 있다.
    이 위치의 `application.properties` 는 `/src/main` 하위의 자바 객체를 실행할 때 동작하는 스프링 설정이다. `spring.profiles.active=local` 이라고 하면 스프링은 `local` 이라는 프로필로 동작한다. 따라서 직전에 설명한 `@Profile("local")` 가 동작하고, `testDataInit` 가 스프링 빈으로 등록된다.
    - 참고로 프로필을 지정하지 않으면 디폴트 `(default)` 프로필이 실행된다.
    - `spring.profiles.active=test` 로 설정하면 스프링은 `test` 라는 프로필로 동작한다. 이 경우 직전에 설명한 `@Profile("local")` 는 프로필 정보가 맞지 않아서 동작하지 않는다. 따라서 `testDataInit` 이라는 스프링 빈도 등록되지 않고, 초기 데이터도 추가하지 않는다.
    
    ```java
    spring.profiles.active=local
    
    ```
    

## 데이터 베이스 식별자

- **데이터베이스 기본 키의 3가지 조건**
    1. `null` 값은 허용하지 않는다.
    2. 유일해야 한다.
    3. 변해선 안 된다.
- **테이블의 기본 키를 선택 전략 2가지**
    - **자연 키(natural key)**
        - 비즈니스에 의미가 있는 키
        - 예: `주민등록번호`, `이메일`, `전화번호`
    - **대리 키(surrogate key)**
        - 비즈니스와 관련 없는 임의로 만들어진 키, 대체 키로도 불린다.
        - 예: `오라클 시퀀스`, `auto_increment`, `identity`, `키생성 테이블`